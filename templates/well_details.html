<!-- templates/well_details.html -->
{% extends "base_dashboard.html" %}

{% block title %}Ø¬Ø²Ø¦ÛŒØ§Øª Ú†Ø§Ù‡ {{ well.well_number }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Ù‡Ø¯Ø± Ú†Ø§Ù‡ -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="bi bi-water"></i>
                    Ú†Ø§Ù‡ {{ well.well_number }} - {{ well.name }}
                </h4>
                <div class="btn-group">
                    <a href="/wells/{{ well.id }}/edit" class="btn btn-warning btn-sm">
                        <i class="bi bi-pencil"></i> ÙˆÛŒØ±Ø§ÛŒØ´
                    </a>
                    <a href="/wells/{{ well.id }}/maintenance" class="btn btn-primary btn-sm">
                        <i class="bi bi-tools"></i> ØªØ¹Ù…ÛŒØ±Ø§Øª
                    </a>
                    <a href="/wells" class="btn btn-secondary btn-sm">
                        <i class="bi bi-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <strong>Ù…ÙˆÙ‚Ø¹ÛŒØª:</strong><br>
                        {{ well.location or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}
                    </div>
                    <div class="col-md-3">
                        <strong>ÙˆØ¶Ø¹ÛŒØª Ù¾Ù…Ù¾:</strong><br>
                        <span class="badge {% if well.pump_status %}bg-success{% else %}bg-danger{% endif %}">
                            {% if well.pump_status %}
                                <i class="bi bi-power"></i> Ø±ÙˆØ´Ù†
                            {% else %}
                                <i class="bi bi-power-off"></i> Ø®Ø§Ù…ÙˆØ´
                            {% endif %}
                        </span>
                    </div>
                    <div class="col-md-3">
                        <strong>ÙˆØ¶Ø¹ÛŒØª Ú†Ø§Ù‡:</strong><br>
                        {% if well.status == 'active' %}
                            <span class="badge {% if well.pump_status %}bg-success{% else %}bg-danger{% endif %}">
                                {% if well.pump_status %}
                                    <i class="bi bi-power"></i> Ø±ÙˆØ´Ù†
                                {% else %}
                                    <i class="bi bi-power-off"></i> Ø®Ø§Ù…ÙˆØ´
                                {% endif %}
                            </span>
                        {% elif well.status == 'inactive' %}
                            <span class="badge bg-secondary">
                                <i class="bi bi-x-circle"></i> ØºÛŒØ±ÙØ¹Ø§Ù„
                            </span>
                        {% elif well.status == 'maintenance' %}
                            <span class="badge bg-warning">
                                <i class="bi bi-tools"></i> Ø¯Ø± Ø­Ø§Ù„ ØªØ¹Ù…ÛŒØ±
                            </span>
                        {% else %}
                            <span class="badge bg-dark">
                                <i class="bi bi-question-circle"></i> Ù†Ø§Ù…Ø´Ø®Øµ
                            </span>
                        {% endif %}
                    </div>
                    <div class="col-md-3">
                        <strong>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:</strong><br>
                        {{ well.created_at_jalali or '-' }}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†ÛŒ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†ÛŒ Ú†Ø§Ù‡</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td width="40%"><strong>Ø¹Ù…Ù‚ Ú©Ù„ Ú†Ø§Ù‡:</strong></td>
                                <td>{{ well.total_depth or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ø¹Ù…Ù‚ Ù†ØµØ¨ Ù¾Ù…Ù¾:</strong></td>
                                <td>{{ well.pump_installation_depth or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ù‚Ø·Ø± Ú†Ø§Ù‡:</strong></td>
                                <td>{{ well.well_diameter or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <!-- removed: casing_type -->
                            </tr>
                            <tr>
                                <!-- removed: well_installation_date -->
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ù…Ù¾ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ”§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ù…Ù¾</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td width="40%"><strong>Ø¨Ø±Ù†Ø¯ Ù¾Ù…Ù¾:</strong></td>
                                <td>{{ well.current_pump_brand or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ù…Ø¯Ù„ Ù¾Ù…Ù¾:</strong></td>
                                <td>{{ well.current_pump_model or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ù‚Ø¯Ø±Øª Ù¾Ù…Ù¾:</strong></td>
                                <td>{{ well.current_pump_power or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <td><strong>ÙØ§Ø²:</strong></td>
                                <td>{{ well.current_pump_phase or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <!-- removed: current_equipment_installation_date -->
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø¨Ù„ Ùˆ Ù„ÙˆÙ„Ù‡ -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ”Œ Ù…Ø´Ø®ØµØ§Øª Ú©Ø§Ø¨Ù„</h5>
                    </div>
                    <div class="card-body">
                        <p>{{ well.current_panel_specs or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“ Ù…Ø´Ø®ØµØ§Øª Ù„ÙˆÙ„Ù‡</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td width="40%"><strong>Ø¬Ù†Ø³ Ù„ÙˆÙ„Ù‡:</strong></td>
                                <td>{{ well.current_pipe_material or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ù…Ø´Ø®ØµØ§Øª Ù„ÙˆÙ„Ù‡:</strong></td>
                                <td>{{ well.current_pipe_specs or 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡' }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¢Ù…Ø§Ø± Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“ˆ Ø¢Ù…Ø§Ø± Ú†Ø§Ù‡</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td width="60%"><strong>ØªØ¹Ø¯Ø§Ø¯ Ø¹Ù…Ù„ÛŒØ§Øª ØªØ¹Ù…ÛŒØ±Ø§Øª:</strong></td>
                                <td>{{ statistics.maintenance_count or 0 }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ø¢Ø®Ø±ÛŒÙ† ØªØ¹Ù…ÛŒØ±Ø§Øª:</strong></td>
                                <td>
                                    {% if statistics.last_maintenance %}
                                        {{ statistics.last_maintenance.operation_type }} - 
                                        {{ statistics.last_maintenance.operation_date }}
                                    {% else %}
                                        Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù¾Ù…Ù¾:</strong></td>
                                <td>
                                    <span class="badge {% if statistics.pump_status %}bg-success{% else %}bg-danger{% endif %}">
                                        {% if statistics.pump_status %}Ø±ÙˆØ´Ù†{% else %}Ø®Ø§Ù…ÙˆØ´{% endif %}
                                    </span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ¹Ù…ÛŒØ±Ø§Øª -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">ğŸ› ï¸ Ø¢Ø®Ø±ÛŒÙ† ØªØ¹Ù…ÛŒØ±Ø§Øª</h5>
                        <a href="/wells/{{ well.id }}/maintenance" class="btn btn-primary btn-sm">
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                        </a>
                    </div>
                    <div class="card-body">
                        {% if maintenance_operations %}
                            <div class="list-group list-group-flush">
                                {% for operation in maintenance_operations[:3] %}
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">{{ operation.operation_type }}</h6>
                                        <small>{{ operation.operation_date_jalali or operation.operation_date }}</small>
                                    </div>
                                    <p class="mb-1">{{ (operation.reason or operation.change_type)[:100] }}{% if (operation.reason or operation.change_type)|length > 100 %}...{% endif %}</p>
                                    <small>ØªÙˆØ³Ø·: {{ operation.recorded_by_name }}</small>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-muted text-center">Ù‡ÛŒÚ† Ø¹Ù…Ù„ÛŒØ§Øª ØªØ¹Ù…ÛŒØ±Ø§ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª -->
        {% if well.notes %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª</h5>
                    </div>
                    <div class="card-body">
                        <p>{{ well.notes }}</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}